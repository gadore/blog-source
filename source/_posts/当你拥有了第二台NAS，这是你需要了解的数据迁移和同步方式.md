---
title: 当你拥有了第二台NAS，这是你需要了解的数据迁移和同步方式
date: 2023-07-26 20:28:38
postUrl: archives/1689128493165
cover: /upload/Snipaste_2023-07-26_21-05-10.png
tags:
- 网络
- 程序员
- NAS
categories:
- 明明白白玩NAS
---
自从有了NAS，我的数字生活总算是找到了一个家，数据安全地躺在这里，不受任何方面的干扰：不用担心供应商跑路，不用害怕数据泄漏，也不需要频繁地在各个云服务商之间颠转腾挪。

但当自己成了自己数字资产的第一负责人后，一系列的顾忌也接踵而至：NAS 的硬盘坏了怎么办？NAS 坏了怎么办？NAS 丢了怎么办？

针对这些问题，网络社区也早有应对答案：RAID 和两地三中心。

针对硬盘损坏，倒还是比较容易解决的。比如，群晖 DS 系列本就设计有双盘、四盘的 RAID 冗余盘位，一般情况下，为了自己的数据安全，初始化的时候可以选择 RAID1、RAID5 等拥有数据冗余的磁盘阵列组合，以此来保障我们的数据不会因为单个磁盘的故障而损坏。

因为数据是无价的，所以我也不敢忽视低概率的另外俩问题：NAS 的损坏、丢失等问题。这也就涉及到了本文的重点：两地三中心的搭建、数据迁移以及数据同步。

## 搭建低配两地三中心

两地三中心，顾名思义：你的数据需要存在于三个数据中心，这三个数据中心至少要存在于两个城市。

我相信购买 NAS 的大多数其实是跟我一样的工薪阶层，暂时还没考虑互联网企业的数据中心、数据机房那种百万级别的服务器集群建设。所以在搭建费用上，我选择的是最低花销方案。

### 1、重要数据加密后上云

云服务商的廉价和低使用成本是我不能忽视的一个选择，群晖的 Cloud Sync 应用支持百度、京东、阿里、微软十多家云服务的接入，在拥有第一台 NAS 后，我就把我的重要数据加密备份到了这种云服务商的平台上，这些平台有一个不能忽视的优点：免费。

![](/upload/Snipaste_2023-07-26_20-40-11.png)可以接入许多公有云服务进行数据同步

你要知道，个人重要资料压缩加密后的空间占用很小，云服务的免费额度已经足够使用了。

而且这些云服务没有任何运维成本、付费后你是爹（比如下载百度云的时候，一次月付即可完成备份数据的下载）。

### 2、第二台 NAS 的购置

在[个人家庭宽带升级](/archives/1683599671683)中有提到，因为本人是大城市打工仔一名，房子自然是买不起的。而且受限于租房的网络条件会因为换租频繁变动，我就在五一假期期间将 NAS 放到了我的老家去了。不但解决了公网 IP 的问题，同时还让我免去了在大城市打工期间频繁地跟房东、运营商、小区网络管理员等人沟通的成本。但这也带来另一个问题：公网访问的网速受限严重。

当时买 NAS 的初衷就是可以随心看自己喜欢看的剧集，但公网速度有时候会极大地剥夺这份快乐：网速差。

![](/upload/Snipaste_2023-07-26_21-21-10.png)在小小的屏幕上转啊转啊转啊转啊，就是不播放

起初我是打算买块硬盘挂到我的台式机，然后在台式机上部署各种各样的服务来最低程度实现第二台 NAS 的。

我可以先把数据同步到我的 Windows 的机械硬盘上，然后在此基础上再进行各种数据服务拓展。

但经过了一周的数据迁移和使用后，我发现这个方案太蹩脚了，而且使用起来非常不方便！

#### PC NAS 耗电难忍

NAS 低功耗的特点可以让我长时间保持机器开机而不用心疼电费，但PC主机待机功耗就高达40 ~ 50W（据我所知，这还不算最高的）,更不要说我当时组装 PC 的时候买的扇热风扇是自带闪瞎眼 RGB 灯效的。

![](/upload/IMG_0371%20(1).jpg)我家猫那几天晚上一直在这种蹦迪环境中

#### 系统体验一言难尽

家里 PC 还同时承担着游戏主机和休闲主机的任务，暂时不能给他换成 TrueNAS 、Unraid 等第三方 NAS 系统。

因此我就尝试在 Windows 上搭建我的一系列服务：Docker、Webdav、Smb，然后再基于 Docker 进行 Emby ，Komga 等服务的搭建。

但我发现这一点也非常不好实现。

首先 Windows 的 IIS 自带的 Webdav Server 最大只支持 4GB 的文件传输（就这都得改注册表才能实现），也就是说超过 4GB 的文件就无法同步过来；那我只好换方案，我用 Smb 协议把文件夹挂载到 Windows 本地，再使用 FreeFileSync 进行数据同步，算是解决了最大文件限制的问题。

但当我把 Docker 中的各个镜像也启动之后，另一个窒息的问题问题来了：我的 16GB 的内存怎么就只剩下 2GB 可用了？！（各种服务存在的同时还用电脑做娱乐或者办公的场景）

干脆再买台 NAS 吧，看着折腾了好几天之后心情愈加难受的镜中的我说道。

于是就有了今天的主角：DS220+。

别问，问就是穷；再问就破防（刚买了半个月，DS224+ 发布了，处理器性能翻倍>\_<）。

### 3、群晖 NAS 间的数据同步软件

早就听说了群晖的数据同步非常完善，所以我也在机器到手后把该装的不该装的都装了一遍。结果发现最终能使用的其实非常少。

先说我的条件：

-   已有的主机是 DS 920+，拥有 20GB 的内存和10TB 的存储空间 ，8TB 存主数据（raid 5）， 2TB 用来当下载缓存盘（无Raid）；
    
-   我有公网域名，通过 DDNS 指向一个动态分配的公网 IP；
    
-   我在主 NAS 上部署了 OpenVPN 来组网，保证我的设备可以在全国各地有网的环境下相互联通；
    
-   当前新买的从机是 DS220+，配备两块16TB 的磁盘组 Raid1；
    

我的诉求：

-   我的两台NAS的主数据相互同步，又可以相互独立使用。
    
-   同步数据时，可以在公网的条件下进行，但又要有一定程度的安全性（ frp 完全暴露要不得）
    

以下是我这几天设置数据迁移过程中的一些使用体验，有任何问题欢迎指正。

#### Hyper Backup

功能：这个软件是把系统整机备份到另一台设备，备份后就相当于是一个加密的压缩包，你反正没法找文件，也没法从中读取任何数据，只能再找一个机器恢复出来。

感受：就像你可以把 iPhone 连接你的电脑，点击备份整机数据。然后等买了新手机后，再点击从备份中恢复一样。

优点：可以备份几乎所有数据。

缺点：只是整机备份，备份后的数据是一个压缩包，无法作为正常可识别数据供我使用。

![](/upload/Snipaste_2023-07-26_20-57-47.png)备份文件夹、备份套件等等，非常细致

#### Migration Assistant

功能：这个迁移助手可以提供 NAS 整机的数据和资料迁移。迁移期间你的很多数据文件夹和服务都会被锁死无法使用，而且迁移后它就结束工作了，你这边的文件如果有什么变动的话，它是不会帮你实时同步的。

优点：就相当于安卓或者 iOS 换机，如果是手中有台 NAS 并且又买了一台新的 NAS 的话，可以使用该功能进行数据的拷贝，会方便不少。

缺点：迁移完成后数据不再同步，迁移过程中还会停用很多服务，而且非常依赖网络环境，网络不稳定会导致任务卡住直接失败，需要重新来。

![](/upload/Snipaste_2023-07-26_21-01-40.png)NAS 版换机助手

#### High Avaliablity

功能：它可以把两台 NAS 主机组成一个热备，实时同步两台机器的所有数据和状态，当其中一台宕机之后，另一台立刻顶上去，让用户可以稳定使用网盘服务。

感受：几乎没有缺点，这个套件其实非常接近我的需求，但它有一个强制性要求：两台主机必须使用物理网线点对点连接（心跳线），无法跨局域网使用。

唉，总之对我而言：不适用。

![](/upload/Snipaste_2023-07-26_21-05-10.png)这个套件适合小型工作室使用

#### Cloud Sync

这款软件可以让你的NAS接入许多商用云，公有云等开放的协议接口，刚买 NAS 的时候用它把百度云中的数据都下载下来了。这次我重新研究了一下它的用途，发现这个套件非常不得了！

功能：它的使用步骤就两步：连接主机、设置同步任务。

连接主机：支持通用的 Webdav 协议、百度云、腾讯云 COS、阿里云对象存储、OneDrive 等等，只需要登录一次。

同步任务：你可以设置多个同步任务，每个任务包含一个本地路径和远程路径，你可以设置同步方向是双向或单项，同步任务可以添加多个。

这款软件完全适用我的需求！

缺点：相比较前三个套件，CloudSync 只能同步用户新建的共享文件夹下的数据，如果数据没有存在共享文件夹下（比如 NoteStation），那就无法进行数据同步了。

![](/upload/Snipaste_2023-07-20_12-20-42.jpg)一个链接下添加多个同步任务

![](/upload/Snipaste_2023-07-20_12-21-04.jpg)可以设置同步计划，如果感觉晚上硬盘太吵可以设置晚上不同步

#### Synology Drive ShareSync (2023-07-31 16:00补充更新)

在网络上跟别人讨论后，发现还有一个套件也能实现跨网络的文件夹同步，甚至不需要公网 IP ，只需要一个quickconnect id，遂赶紧补充到这里。

功能：可以使用 qc id 进行同步，无需公网 IP 、可以选择开启了团队文件夹的所有文件数据

感受：这个群晖自带的套件使用更加简洁方便（相比较Cloud Sync），对两台 NAS 的要求也更少，更适合不喜欢折腾的人使用。

![Snipaste_2023-07-31_16-10-47.jpg](/upload/Snipaste_2023-07-31_16-10-47.jpg)使用前提：在DriveServer控制台为共享文件夹开启团队文件夹功能

![](/upload/Snipaste_2023-07-31_16-13-16.jpg)也拥有类似Cloud Sync的同步逻辑设置，但没有任务执行时间策略调整

### 4、网络

网络的联通其实是一切跨互联网同步的基础，关于公网 IP 和动态域名的映射问题，我在[**个人家庭宽带公网 IP 升级杂记**](/archives/1683599671683)里也提到过，不再赘述。

这里单独说一下当时让我头疼了很久但最后发现很简单的一件事：Openvpn 的连接。

在 PC 上也好，移动端也好，我都可以非常简单地找到客户端来导入我的配置文件并登陆我的主机，完成设备组网并连接到我的主机上。但群晖的商店却无论如何找不到这个客户端软件，开源社区也是。

我当时在想：难道没人这么用过？

结果答案却让我笑掉大牙：依次打开【控制面板】【网络】【新增】。

![](/upload/Snipaste_2023-07-26_21-11-24.png)看到熟悉的字段了吗？

喔，我的老伙计，原来你在这啊！

这是我的[明明白白玩NAS系列](/categories/明明白白玩NAS/)的第**六**篇文章了，如果你对这个系列的其他文章感兴趣，可以访问[这里](/categories/明明白白玩NAS/)查看。